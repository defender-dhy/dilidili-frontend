(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b6f898f2"],{"4fae":function(t,s,e){"use strict";var i=e("5d14"),o=e.n(i);o.a},"5d14":function(t,s,e){},7555:function(t,s,e){"use strict";e.d(s,"d",function(){return n}),e.d(s,"e",function(){return a}),e.d(s,"b",function(){return c}),e.d(s,"a",function(){return r}),e.d(s,"f",function(){return m}),e.d(s,"c",function(){return u});var i=e("bc3a"),o=e.n(i),n=function(t){return o.a.post("/api/v1/user/login",t).then(function(t){return t.data})},a=function(t){return o.a.post("/api/v1/user/register",t).then(function(t){return t.data})},c=function(){return o.a.get("/api/v1/user/me").then(function(t){return t.data})},r=function(){return o.a.delete("/api/v1/user/logout").then(function(t){return t.data})},m=function(t){return o.a.put("/api/v1/user/account",t).then(function(t){return t.data})},u=function(t){return o.a.get("/api/v1/users/".concat(t)).then(function(t){return t.data})}},c446:function(t,s,e){"use strict";e.r(s);var i=function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"im"},[e("div",{staticClass:"main-im-s"},[e("div",{staticClass:"maim-im"},[e("div",{staticClass:"im-master"},[e("img",{staticClass:"im-m-avater",staticStyle:{width:"60px",height:"60px","border-radius":"30px"},attrs:{src:t.me.avatar}})]),e("div",{staticClass:"im-m-list"},[e("div",{staticClass:"im-m-l-search"},[e("input",{staticClass:"im-m-l-s-input",attrs:{type:"text",placeholder:"搜索群组/用户"}}),e("div",{staticClass:"im-m-l-add",on:{click:t.addNewRoom}})]),e("div",{staticClass:"im-m-l-list"},t._l(t.listRooms,function(s,i){return e("div",{key:i,class:t.isFocus==i?"im-m-l-l-room-focus":"im-m-l-l-room",on:{click:function(s){return t.changeRoom(i)}}},[e("img",{staticStyle:{width:"48px",height:"48px","border-radius":"24px"},attrs:{src:s.avatar,alt:""}}),e("div",{staticClass:"im-m-l-l-r-main"},[e("div",{staticClass:"im-m-l-r-m-name",staticStyle:{color:"#f7f7f7","font-size":"14px"}},[e("p",[t._v(t._s(s.groupName))])])])])}),0)]),e("div",{staticClass:"im-char"},[e("div",{staticClass:"im-c-header"},[e("h2",{staticStyle:{"font-size":"16px",color:"#333"}},[t._v(t._s(t.chatMain.groupName))])]),e("div",{staticClass:"im-c-message",attrs:{id:"im-c-msg"}},t._l(t.msgs,function(s,i){return e("div",{key:i,class:s.userID!=t.me.uid?"im-c-m-msg-left":"im-c-m-msg-right"},[e("img",{staticClass:"im-c-m-avater",attrs:{src:s.from_avatar,alt:""}}),e("div",{class:s.userID!=t.me.uid?"im-c-m-m-left":"im-c-m-m-right"},[e("div",{class:s.userID!=t.me.uid?"im-c-m-m-name-left":"im-c-m-m-name-right"},[e("span",{staticClass:"im-c-m-m-name-name",staticStyle:{"margin-right":"0",color:"#333","font-size":"13px"}},[t._v(t._s(s.from_name))]),e("span",{staticClass:"im-c-m-m-name-time",staticStyle:{color:"#666","font-size":"12px","margin-left":"4px","margin-right":"4px"}},[t._v(t._s(t.timestampToTime(s.created_at)))])]),e("div",{staticStyle:{display:"flex"}},[1==s.msg_type?e("div",{class:s.userID!=t.me.uid?"im-c-m-m-txt-left":"im-c-m-m-txt-right"},[e("div",{staticStyle:{"user-select":"text","word-break":"break-word"}},[t._v(t._s(s.msg))])]):t._e(),2==s.msg_type?e("div",{class:s.userID!=t.me.uid?"im-c-m-m-txt-left":"im-c-m-m-txt-right"},[e("img",{staticStyle:{"max-width":"400px","max-height":"450px"},attrs:{src:s.msg}})]):t._e(),e("div",{class:s.userID!=t.me.uid?"im-c-m-m-3-left":"im-c-m-m-3-right"})])])])}),0),e("div",{staticClass:"im-c-charInput"},[e("div",{staticClass:"im-c-c-img-no"}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.toMsg.msg,expression:"toMsg.msg"}],staticClass:"im-c-c-input",attrs:{type:"text",placeholder:"聊点什么吧 (/≧▽≦/) "},domProps:{value:t.toMsg.msg},on:{keyup:function(s){return!s.type.indexOf("key")&&t._k(s.keyCode,"enter",13,s.key,"Enter")?null:t.putMsg(s)},input:function(s){s.target.composing||t.$set(t.toMsg,"msg",s.target.value)}}}),e("div",{staticClass:"im-c-c-img-yes",on:{click:t.putMsg}})])])])])])},o=[],n=e("7555"),a=e("bc3a"),c=e.n(a),r=function(t){return c.a.post("/api/v1/group/create",t).then(function(t){return t.data})},m=function(){return c.a.get("/api/v1/user/groups").then(function(t){return t.data})},u=function(t){return c.a.get("/api/v1/group/msgs/".concat(t)).then(function(t){return t.data})},l={name:"IM",data:function(){return{isFocus:0,chatMain:{groupName:""},msgs:[],websock:null,createRoomForm:{name:"",type:1},toMsg:{user_id:1,to:1,type:1,msg:""},me:{uid:0,nickname:"",avatar:""},listRooms:[]}},created:function(){this.initWebSocket(),this.load()},destroyed:function(){this.websock.close()},methods:{load:function(){var t=this;n["b"]().then(function(s){t.me.uid=s.data.id,t.me.nickname=s.data.nickname,t.me.avatar=s.data.avatar}),m().then(function(s){if(s.status>0)t.$notify.error({title:"失败",message:s.msg});else{t.listRooms=s.data.items,t.chatMain=t.listRooms[0];for(var e=0;e<t.listRooms.length;e++){var i={ws_header:"link",id:t.listRooms[e].id};t.websocketsend(JSON.stringify(i)),u(t.listRooms[e].id).then(function(s){for(var e=0;e<t.listRooms.length;e++)if(null!=s.data.items){if(t.listRooms[e].id==s.data.items[0].to){t.listRooms[e]["msgs"]=s.data.items.reverse(),0==e&&(t.msgs=t.listRooms[0].msgs,t.scrollToBottom());break}}else t.listRooms[e]["msgs"]=[]})}}}).catch(function(s){t.$notify.error({title:"加载失败惹",message:s})})},putMsgSubmit:function(){var t=this.toMsg;t["ws_header"]="msg",this.websocketsend(JSON.stringify(t))},putMsg:function(){if(""!=this.toMsg.msg){var t=this.toMsg;t.user_id=this.me.uid,t.type=1,t.to=this.listRooms[this.isFocus].id,t["ws_header"]="msg",this.websocketsend(JSON.stringify(t)),console.log(t),this.toMsg.msg=""}},createRoomSubmit:function(){var t=this;r(this.createRoomForm).then(function(s){console.log(s),s.status>0&&t.$notify.error({title:"失败",message:s.msg})}).catch(function(s){t.$notify.error({title:"创建失败惹",message:s})})},addNewRoom:function(){var t=this;this.$prompt("请输入房间名","创建小房间",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^[A-Za-z0-9\u4e00-\u9fa5]+$/,inputErrorMessage:"不允许有特殊字符哦°(°ˊДˋ°) °"}).then(function(s){var e=s.value,i={name:"",type:1};i.name=e,r(i).then(function(s){console.log(s),s.status>0?t.$notify.error({title:"失败",message:s.msg}):t.$message({type:"success",message:"创建成功"})}).catch(function(s){t.$notify.error({title:"创建失败惹",message:s})})}).catch(function(){t.$message({type:"info",message:"取消创建"})})},changeRoom:function(t){this.isFocus=t,this.chatMain=this.listRooms[this.isFocus],this.msgs=this.listRooms[this.isFocus].msgs,this.scrollToBottom()},getMsg:function(t){var s=document.getElementById("im-c-msg"),e=0;s.scrollTop+s.clientHeight>=s.scrollHeight-3&&(e=1,console.log(1));for(var i=0;i<this.listRooms.length;i++)if(this.listRooms[i].id==t.data.to){this.listRooms[i].msgs.push(t.data),this.isFocus==i&&(this.msgs=this.listRooms[this.isFocus].msgs);break}this.$nextTick(function(){console.log(3),1==e&&(s.scrollTop=s.scrollHeight-s.clientHeight,console.log(2))})},scrollToBottom:function(){var t=document.getElementById("im-c-msg");this.$nextTick(function(){t.scrollTop=t.scrollHeight-t.clientHeight})},timestampToTime:function(t){t/1e10<=1&&(t*=1e3);var s=new Date(t),e=(s.getFullYear(),(s.getMonth()+1<10?"0"+(s.getMonth()+1):s.getMonth()+1)+"/"),i=(s.getDate()<10?"0"+s.getDate():s.getDate())+" ",o=s.getHours()+":",n=s.getMinutes();s.getSeconds();return e+i+o+n},initWebSocket:function(){var t="ws://"+window.location.host+"/api/v1/ws";this.websock=new WebSocket(t),this.websock.onmessage=this.websocketonmessage,this.websock.onopen=this.websocketonopen,this.websock.onerror=this.websocketonerror,this.websock.onclose=this.websocketclose},websocketonopen:function(){var t={ws_header:"ping"};this.websocketsend(JSON.stringify(t))},websocketonerror:function(){this.initWebSocket()},websocketonmessage:function(t){var s=JSON.parse(t.data);switch(s.status){case 0:this.getMsg(s);break;case 1:break;case 50001:console.log(s.msg);break}},websocketsend:function(t){this.websock.send(t)},websocketclose:function(t){console.log("断开连接")}},mounted:function(){this.timer=setInterval(this.websocketonopen,3e4)},beforeDestroy:function(){clearInterval(this.timer)}},g=l,d=(e("4fae"),e("2877")),h=Object(d["a"])(g,i,o,!1,null,null,null);s["default"]=h.exports}}]);
//# sourceMappingURL=chunk-b6f898f2.c73bf911.js.map